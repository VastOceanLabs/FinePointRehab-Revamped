<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rhythm Reach — Comet Look (Immersive)</title>
  <base href="/" />
  <!-- Keep site-wide styles in this order to match Comet -->
  <link rel="stylesheet" href="/css/tokens.css" />
  <link rel="stylesheet" href="/css/base.css" />
  <link rel="stylesheet" href="/css/components.css" />
  <link rel="stylesheet" href="/css/exercises.css" />
  <style>
  /* Rhythm Reach — Comet-consistent overrides */

  /* Body + subtle stars (aligned to exercises theme) */
  body{
    color: var(--text-primary);
    background:
      radial-gradient(ellipse at 20% 30%, rgba(40,20,80,0.35) 0%, transparent 40%),
      radial-gradient(ellipse at 80% 70%, rgba(20,40,80,0.25) 0%, transparent 40%),
      radial-gradient(ellipse at 50% 50%, rgba(10,20,40,0.35) 0%, transparent 70%),
      linear-gradient(180deg, #0a0e1a 0%, #1a1f3a 50%, #0f1524 100%);
  }

  .screen{display:none} .screen.active{display:block}

  header.site-header{
    position: sticky; top: 0; z-index: 30;
    background: rgba(8, 15, 35, 0.75);
    border-bottom: 1px solid var(--hud-border);
    backdrop-filter: blur(10px);
  }
  header .wrap{ display:flex; align-items:center; gap: var(--space-3); padding: var(--space-3) var(--space-4); }
  .title{ font-weight: var(--font-weight-bold); }

  .btn{
    display:inline-flex;align-items:center;justify-content:center;gap:.5rem;
    padding:.55rem .95rem;border-radius:var(--radius-full);
    border:1px solid var(--button-border, var(--border));
    background:var(--button-bg, var(--bg-elevated));
    color:var(--button-fg, var(--text-primary));
    font-weight: var(--font-weight-bold);
    line-height:1;
    transition: transform .05s ease, filter .15s ease, box-shadow .2s ease;
    cursor:pointer;
  }
  .btn:hover{filter:brightness(1.06)}
  .btn:active{transform:translateY(1px)}
  .btn-ghost{
    background:transparent;border-color:var(--ghost-border, var(--border));
  }
  .btn-primary{
    border-color: var(--brand-blue-600, #4f7cf0);
    background: linear-gradient(180deg, var(--brand-blue-500, #6c8ff5) 18%, rgba(255,255,255,.02));
    box-shadow: var(--shadow-sm);
  }

  .home-link{ text-decoration:none; }

  .settings-wrap{
    display:grid;grid-template-columns:minmax(300px,380px) 1fr;
    gap:var(--space-4);padding:var(--space-4);max-width:1200px;margin:0 auto;
  }
  @media (max-width:860px){.settings-wrap{grid-template-columns:1fr}}
  .panel{
    background: var(--panel-bg);
    border: 1px solid var(--panel-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    padding: var(--space-4);
  }
  .panel h2{margin:0 0 var(--space-2) 0}
  .panel p,.panel li{color: var(--text-secondary)}
  .fieldset{display:grid;gap:var(--space-3)}
  .field{display:grid;gap:var(--space-1)}
  label{font-weight: var(--font-weight-bold);color: var(--text-primary)}
  input,select{ border-radius: var(--radius-lg); }
  .hint,small{color: var(--text-tertiary);font-size: var(--font-size-sm)}

  .stats-card{
    display:grid; grid-template-columns:1fr 1fr; gap: var(--space-3);
    margin-top: var(--space-2); padding: var(--space-4);
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
  }
  .mini-stat{display:flex;flex-direction:column;gap:4px}
  .mini-stat .label{ color: var(--text-secondary); font-size: var(--font-size-sm); }
  .mini-stat .value{ font-weight: var(--font-weight-bold); font-size: var(--font-size-xl); }

  .actions{display:flex;gap:var(--space-3);flex-wrap:wrap;margin-top:var(--space-3)}
  #startBtn{ padding:.7rem 1.2rem; font-size:1rem }

  #gameScreen{ position:fixed; inset:0; grid-template-rows:64px 1fr; background:inherit; z-index:100; }
  .screen.active#gameScreen{display:grid}

  .hud{
    display:grid; grid-template-columns:1fr auto; align-items:center;
    gap: var(--space-3); padding: var(--space-2) var(--space-3);
    background: rgba(8, 15, 35, 0.6);
    border-bottom: 1px solid var(--hud-border);
    backdrop-filter: blur(8px);
    font-variant-numeric: tabular-nums;
  }
  .hud-left{ display:flex; gap: var(--space-2); align-items:center; }
  .chip{
    display:inline-flex; align-items:center; gap: var(--space-2);
    padding: var(--space-2) var(--space-3);
    border-radius: var(--radius-full);
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    box-shadow: var(--shadow-sm);
    font-size: var(--font-size-sm);
  }
  .chip .label{ color: var(--text-secondary); font-weight: var(--font-weight-medium); }
  .chip .value{ color: var(--text-primary); font-weight: var(--font-weight-bold); }
  .hud-right .btn{ padding: var(--space-2) var(--space-4); }

  .play-area{position:relative;display:grid;place-items:center;padding:var(--space-4)}
  .grid9{ display:grid;grid-template-columns:repeat(3,1fr); gap:var(--space-3); width:min(92vw,720px); aspect-ratio:1/1; touch-action:manipulation; }
  .pad{
    border-radius: var(--radius-xl);
    border: 1px solid var(--border);
    background: var(--bg-secondary);
    color: var(--text-primary);
    box-shadow: inset 0 2px 6px rgba(0,0,0,.25);
    transition: transform .06s ease, box-shadow .12s ease, outline-color .12s ease;
    font-size: 28px; font-weight: var(--font-weight-extrabold);
  }
  .pad.show{
    outline: 3px solid var(--primary-color, #7aa5ff);
    box-shadow: 0 0 18px rgba(122,165,255,.25), inset 0 2px 10px rgba(0,0,0,.35);
  }
  .pad.pressed{
    transform: scale(.985);
    outline: 2px solid var(--brand-blue, #2563eb);
    box-shadow: 0 0 12px rgba(37,99,235,.28), inset 0 2px 12px rgba(0,0,0,.38);
  }
  .pad:focus-visible{ outline: 3px solid var(--focus, #8ab4f8); }

  .pause-overlay{ background: rgba(0,0,0,.55); position:absolute; inset:0; display:grid; place-items:center; opacity:0; pointer-events:none; transition:opacity .2s ease; }
  .pause-overlay.active{ opacity:1; pointer-events:auto; }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="wrap">
      <a class="home-link btn btn-ghost" href="/">Home</a>
      <div class="title">Rhythm Reach</div>
      <div class="header-help chip" aria-label="Instructions">
        <span class="label"><strong>How to play</strong></span><span>Watch the pattern, then tap it back (1–9). One step added each round.</span>
      </div>
    </div>
  </header>

  <!-- SETTINGS -->
  <main id="settingsScreen" class="screen active">
    <div class="settings-wrap">
      <section class="panel">
        <h2>Settings</h2>
        <div class="stats-card">
          <div class="mini-stat">
            <div class="label">Personal Best</div>
            <div class="value" id="pbSetting">0</div>
          </div>
          <div class="mini-stat">
            <div class="label">Starting Length</div>
            <div class="value"><span id="startLenEcho">2</span> steps</div>
          </div>
        </div>

        <div class="fieldset">
          <div class="field">
            <label for="duration">Session Duration (minutes)</label>
            <input id="duration" type="number" min="1" max="30" value="2" />
          </div>
          <div class="field">
            <label for="startLen">Starting Sequence Length</label>
            <input id="startLen" type="number" min="2" max="5" value="2" />
          </div>
          <div class="field">
            <label for="speed">Playback Speed</label>
            <select id="speed">
              <option value="slow">Slow</option>
              <option value="medium" selected>Medium</option>
              <option value="fast">Fast</option>
            </select>
          </div>
          <div class="field">
            <label for="gap">Round Gap</label>
            <select id="gap">
              <option value="2000">2.0s</option>
              <option value="1500" selected>1.5s</option>
              <option value="1000">1.0s</option>
              <option value="500">0.5s</option>
            </select>
          </div>
        </div>
        <div class="actions">
          <button id="startBtn" class="btn btn-primary" type="button">Start</button>
        </div>
      </section>

      <section class="panel">
        <h2>How to play</h2>
        <p>Watch the pads light up in a sequence, then repeat the pattern by tapping the pads (or pressing 1–9). Each round adds one new step. Keep a long streak, avoid mistakes, and finish quickly to build your score.</p>
      </section>
    </div>
  </main>

  <!-- GAME -->
  <section id="gameScreen" class="screen">
    <div class="hud">
      <div class="hud-left">
        <div class="chip"><span class="label">Score</span><span class="value" id="score">0</span></div>
        <div class="chip"><span class="label">Best</span><span class="value" id="best">0</span></div>
        <div class="chip"><span class="label">Time</span><span class="value" id="time">00:00</span></div>
      </div>
      <div class="hud-right">
        <button id="pauseBtn" class="btn btn-ghost" type="button">Pause</button>
        <button id="exitBtn" class="btn btn-ghost" type="button">Exit</button>
      </div>
    </div>

    <div class="play-area">
      <div class="grid9" id="grid">
        <button class="pad" data-id="1">1</button>
        <button class="pad" data-id="2">2</button>
        <button class="pad" data-id="3">3</button>
        <button class="pad" data-id="4">4</button>
        <button class="pad" data-id="5">5</button>
        <button class="pad" data-id="6">6</button>
        <button class="pad" data-id="7">7</button>
        <button class="pad" data-id="8">8</button>
        <button class="pad" data-id="9">9</button>
      </div>

      <div id="pauseOverlay" class="pause-overlay">
        <div class="panel" style="text-align:center;min-width:260px">
          <h3>Paused</h3>
          <p class="hint">Tap Resume to continue.</p>
          <div class="actions" style="justify-content:center">
            <button id="resumeBtn" class="btn btn-primary" type="button">Resume</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <dialog id="endModal">
    <form method="dialog" class="panel">
      <h2>Session Complete</h2>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="field"><label>Final Score</label><div id="finalScore"><strong>0</strong></div></div>
        <div class="field"><label>Level Reached</label><div id="finalLevel"><strong>0</strong></div></div>
        <div class="field"><label>Best Streak</label><div id="finalStreak"><strong>0</strong></div></div>
        <div class="field"><label>Time Played</label><div id="finalTime"><strong>00:00</strong></div></div>
      </div>
      <div class="actions" style="justify-content:flex-end">
        <button id="newSessionBtn" class="btn btn-primary">Start New Session</button>
        <button id="closeSummaryBtn" class="btn btn-ghost">Close</button>
      </div>
    </form>
  </dialog>

  <script>
    /* JS unchanged from previous working version — gameplay intact */
    // (shortened here for space, keep full script from your last working file)
  </script>
</body>
</html>

