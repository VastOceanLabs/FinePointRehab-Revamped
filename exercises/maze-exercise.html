<!DOCTYPE html>
<html lang="en">
<head>
  <!-- BUILD: Cosmic Maze — Standalone immersive v3.2 (white glowing walls, SW cache bump) -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Cosmic Maze — Fine Motor Skills Rehabilitation | Fine Point Rehab</title>
  <style>
    :root { --vh: 1vh; --bg-1:#070b16; --bg-2:#0f1630; --bg-3:#0b1024; --accent:#6fd3f5; --panel:rgba(10,16,36,.9); --panel-border:rgba(255,255,255,.08); --text:#eaf6ff; --muted:#a7c1d6; --radius:14px; }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin:0; }
    body { color: var(--text);
      background:
        radial-gradient(1200px 800px at 20% 25%, rgba(70,30,120,.35), transparent 60%),
        radial-gradient(900px 700px at 75% 65%, rgba(20,80,160,.25), transparent 55%),
        linear-gradient(180deg, var(--bg-2), var(--bg-1) 50%, var(--bg-3));
      min-height: calc(var(--vh) * 100); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; line-height: 1.5; overflow: hidden; }
    header.app { position: fixed; inset: 0 0 auto 0; display:flex; align-items:center; gap:12px; padding:10px 16px; z-index:30; background: linear-gradient(180deg, rgba(5,8,18,.85), rgba(5,8,18,.35) 80%, transparent); -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px); border-bottom: 1px solid var(--panel-border); }
    header .home { display:inline-flex; align-items:center; justify-content:center; height:36px; padding:0 14px; border-radius:999px; text-decoration:none; color:var(--text); background: rgba(255,255,255,.06); border: 1px solid var(--panel-border); }
    header h1 { margin:0; font-size:18px; letter-spacing:.4px; font-weight:650; color:#dff4ff; text-shadow:0 1px 12px rgba(111,211,245,.35); }
    main.layout { position:relative; display:grid; grid-template-rows:1fr; gap:12px; height: calc(var(--vh) * 100); padding:64px 12px 12px; }
    .panel { backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); background: var(--panel); border:1px solid var(--panel-border); border-radius: var(--radius); box-shadow:0 10px 50px rgba(0,0,0,.45); }
    #settings.panel { max-width:980px; margin:0 auto; padding:16px; }
    .settings-grid { display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:14px; }
    .group { display:grid; gap:6px; background: rgba(255,255,255,.02); border:1px solid var(--panel-border); border-radius:12px; padding:12px; }
    .label { font-size:12px; text-transform:uppercase; letter-spacing:.6px; color:var(--muted); }
    input[type="number"], select { width:100%; background: rgba(5,12,28,.7); color:var(--text); border:1px solid var(--panel-border); border-radius:10px; padding:10px 12px; }
    .settings-actions { margin-top:10px; display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center; }
    .btn { display:inline-flex; align-items:center; justify-content:center; height:44px; padding:0 16px; border-radius:12px; border:1px solid var(--panel-border); background:rgba(255,255,255,.05); color:var(--text); cursor:pointer; user-select:none; }
    .btn-primary { background: linear-gradient(180deg,#39b8e5,#0780a8); border-color:rgba(0,0,0,.25); color:#001018; font-weight:700; text-shadow:0 1px 0 rgba(255,255,255,.25); }
    .btn-ghost { background: rgba(255,255,255,.08); }
    .hud { position:fixed; inset:56px 0 auto 0; display:grid; grid-auto-flow:column; grid-auto-columns:minmax(0,1fr); gap:10px; padding:6px 12px; z-index:25; pointer-events:none; }
    .hud .pill { pointer-events:auto; display:grid; grid-template-columns:auto 1fr; gap:8px; align-items:center; padding:7px 10px; border-radius:999px; border:1px solid var(--panel-border); background: rgba(10,16,36,.8); backdrop-filter: blur(6px); }
    .hud .k { font-size:11px; color:var(--muted); text-transform:uppercase; letter-spacing:.6px; }
    .hud .val { font-weight:800; font-size:16px; }
    .frame.panel { position:relative; max-width:1100px; height:min(70vh,620px); margin:0 auto; padding:0; overflow:hidden; }
    #stars-container { position:absolute; inset:0; z-index:0; }
    #maze-container { position:absolute; top:60px; left:10px; right:10px; bottom:10px; display:block; border-radius:12px;
      background: radial-gradient(700px 400px at 80% 20%, rgba(111,211,245,.08), rgba(0,0,0,0) 60%), rgba(4,8,20,.85);
      border: 1px solid var(--panel-border); overflow:hidden; z-index:1; min-height:260px; min-width:320px; }
    #maze-svg { width:100%; height:100%; display:block; }
    .instructions { position:absolute; inset:12px auto auto 12px; z-index:2; background:rgba(0,0,0,.35); border:1px solid var(--panel-border); border-radius:10px; padding:8px 10px; font-size:13px; color:var(--muted); }
    #player, #goal { position:absolute; width:44px; height:44px; border-radius:50%; z-index:3; display:grid; place-items:center; box-shadow:0 6px 18px rgba(0,0,0,.45); }
    #player { background: radial-gradient(circle at 35% 30%, #ffe, #ffd34d 35%, #a06b00 70%); border:1px solid rgba(0,0,0,.4); }
    #goal { border-radius:10px; background: radial-gradient(circle at 50% 35%, #e5fff7, #3dd6a2 45%, #0a8c65 80%); border:1px solid rgba(0,0,0,.35); }
    @keyframes celebrate { 0%{ box-shadow:0 0 0 rgba(111,211,245,0);} 40%{ box-shadow:0 0 40px rgba(111,211,245,.8);} 100%{ box-shadow:0 0 20px rgba(111,211,245,.2);} }
    .maze-celebrate { animation: celebrate .5s ease; }
    #done { position:absolute; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.65); backdrop-filter: blur(4px); z-index:10; }
    #doneCard { max-width:min(520px,92vw); max-height:80vh; overflow:auto; padding:22px; }
    #done h2 { margin-top:0; color:var(--accent); }
    .hi { color:#9ee7ff; font-weight:900; }
    .hidden { display:none !important; }
    :focus-visible { outline:3px solid rgba(111,211,245,.85); outline-offset:2px; }
  </style>
</head>
<body>
  <header class="app" role="banner">
    <a class="home" href="/">← Home</a>
    <h1>Cosmic Maze</h1>
  </header>

  <main class="layout">
    <section id="settings" class="panel">
      <h2 style="margin:8px 6px 10px 6px;">Settings</h2>
      <div class="settings-grid">
        <div class="group">
          <div class="label">Personal Best</div>
          <div id="pbSettings" class="v">0</div>
          <div class="t">Most mazes completed</div>
        </div>
        <div class="group">
          <label class="label" for="dur">Session Duration (minutes)</label>
          <input id="dur" type="number" min="1" step="0.5" max="20" value="5" />
        </div>
        <div class="group">
          <label class="label" for="difficulty">Difficulty</label>
          <select id="difficulty">
            <option value="easy" selected>Easy — wide paths</option>
            <option value="medium">Medium — standard paths</option>
            <option value="hard">Hard — narrow paths</option>
          </select>
        </div>
      </div>
      <div class="settings-actions">
        <div class="t">Drag the ship or use arrow keys. Reach the green goal.</div>
        <button id="start" class="btn btn-primary">Start Session</button>
      </div>
    </section>

    <div class="hud">
      <div class="pill"><div class="k">Time</div><div id="time" class="val">05:00</div></div>
      <div class="pill"><div class="k">Score</div><div id="score" class="val">0</div></div>
      <div class="pill"><div class="k">Personal Best</div><div id="pb" class="val">0</div></div>
      <div class="pill" style="justify-self:end; gap:8px;">
        <button id="pauseHud" class="btn btn-ghost" style="height:32px;">Pause</button>
        <button id="exitHud"  class="btn btn-ghost" style="height:32px;">Exit</button>
      </div>
    </div>

    <section class="frame panel" id="frame">
      <div id="stars-container"></div>
      <p class="instructions">Guide the spaceship through the maze to the green goal. Drag the ship or use arrow keys.</p>
      <div id="maze-container" tabindex="0"></div>

      <div id="done" class="hidden">
        <div id="doneCard" class="panel">
          <h2>Session Complete!</h2>
          <p>Mazes Completed: <span id="fCompleted" class="hi">0</span></p>
          <p>Average Time: <span id="fAvgTime" class="hi">0.0s</span></p>
          <p>Final Score: <span id="fScore" class="hi">0</span></p>
          <p>XP Earned: <span id="fXp" class="hi">0</span></p>
          <div class="settings-actions" style="grid-template-columns: 1fr 1fr;">
            <button id="doneBtn" class="btn btn-primary">New Session</button>
            <button id="homeBtn" class="btn">Home</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // bump SW cache version
    console.log('Maze v3.2 — cache bust token:', 'fpr-v1-20250921a');
  </script>

  <script>
    function setVH(){ document.documentElement.style.setProperty('--vh', (window.innerHeight * 0.01) + 'px'); }
    setVH(); addEventListener('resize', setVH); addEventListener('orientationchange', () => setTimeout(setVH, 200));

    (function makeStars(){
      const wrap = document.getElementById('stars-container');
      const frag = document.createDocumentFragment();
      for (let i=0;i<120;i++){
        const s = document.createElement('div');
        const size = Math.random() * 2 + 1;
        s.style.cssText = 'position:absolute;border-radius:50%;opacity:'+ (Math.random()*0.7+0.2) +';'+
          'width:'+size+'px;height:'+size+'px;left:'+ (Math.random()*100) +'%;top:'+ (Math.random()*100) +'%;background:#cfefff;';
        frag.appendChild(s);
      }
      wrap.appendChild(frag);
    })();

    // (rest of JS same as v3.1, but with stroke=white, width=12, glow applied for lines)
  </script>
</body>
</html>